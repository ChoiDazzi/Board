<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="kr.letech.study.board.dao.BoardDAO">
    <select id="getNavItems" resultType="kr.letech.study.board.vo.BoardVO">
        SELECT BOARD_ID
             , BOARD_NM
          FROM TB_BOARD
         WHERE DEL_YN = 'N'
    </select>

    <select id="getAllPostByBoard" resultType="kr.letech.study.board.vo.PostVO" parameterType="kr.letech.study.board.vo.BoardVO">
        SELECT TP.POST_ID
             , TP.USER_ID
             , TU.USER_NM
             , TP.POST_TTL
             , TP.RGST_DT
             , TP.UPDT_DT
          FROM TB_POST TP
         INNER JOIN TB_USER TU ON (TP.USER_ID = TU.USER_ID)
         WHERE TP.BOARD_ID = #{boardId}
           AND TP.DEL_YN = 'N'
         <choose>
            <when test="type != null and type.equals('postTtl')">
            AND TP.POST_TTL LIKE CONCAT('%', #{keyword}, '%')
            </when>
            <when test="type != null and type.equals('postCnt')">
            AND TP.POST_CNT LIKE CONCAT('%', #{keyword}, '%')
            </when>
            <when test="type != null and type.equals('userNm')">
            AND TU.USER_NM LIKE #{keyword}
            </when>
         </choose>
         ORDER BY RGST_DT DESC
    </select>

    <select id="getBoardSeq" resultType="string">
        select LPAD(NEXTVAL(BOARD_SEQ), 4, '0')
    </select>

    <update id="modifyBoard" parameterType="kr.letech.study.board.vo.BoardVO">
        UPDATE TB_BOARD
           SET BOARD_NM = #{boardNm}
             , UPDT_DT = NOW()
             , UPDT_ID = #{updtId}
         WHERE BOARD_ID = #{boardId}
    </update>

    <update id="deleteBoard" parameterType="string">
        UPDATE TB_BOARD
           SET DEL_YN = 'Y'
             , UPDT_DT = NOW()
             , UPDT_ID = #{updtId}
         WHERE BOARD_ID = #{boardId}
    </update>

    <insert id="insertBoard" parameterType="kr.letech.study.board.vo.BoardVO">
        INSERT INTO TB_BOARD ( BOARD_ID
                             , BOARD_NM
                             , RGST_DT
                             , RGST_ID
                             , UPDT_DT
                             , UPDT_ID
                             , DEL_YN)
        VALUES ( #{boardId}
               , #{boardNm}
               , NOW()
               , #{rgstId}
               , NOW()
               , #{updtId}
               , 'N')
    </insert>
</mapper>
SET SESSION FOREIGN_KEY_CHECKS=0;

/* Drop Tables */

DROP TABLE IF EXISTS TB_CMNT;
DROP TABLE IF EXISTS TB_POST;
DROP TABLE IF EXISTS TB_BOARD;
DROP TABLE IF EXISTS TB_FILE;
DROP TABLE IF EXISTS TB_USERAUTH;
DROP TABLE IF EXISTS TB_ROLE;
DROP TABLE IF EXISTS TB_USER;




/* Create Tables */

CREATE TABLE TB_BOARD
(
	BOARD_ID varchar(5) NOT NULL,
	BOARD_NM varchar(10) NOT NULL,
	RGST_DT timestamp DEFAULT NOW() NOT NULL,
	RGST_ID varchar(20),
	UPDT_DT timestamp DEFAULT NOW() NOT NULL,
	UPDT_ID varchar(20),
	DEL_YN char(1) DEFAULT 'N' NOT NULL,
	PRIMARY KEY (BOARD_ID)
);


CREATE TABLE TB_CMNT
(
	CMNT_ID varchar(40) NOT NULL,
	POST_ID varchar(40) NOT NULL,
	USER_ID varchar(20) NOT NULL,
	CMNT_DTL text NOT NULL,
	RGST_DT timestamp DEFAULT NOW() NOT NULL,
	RGST_ID varchar(20),
	UPDT_DT timestamp DEFAULT NOW() NOT NULL,
	UPDT_ID varchar(20),
	DEL_YN char(1) DEFAULT 'N' NOT NULL,
	PRIMARY KEY (CMNT_ID)
);


CREATE TABLE TB_FILE
(
	FILE_ID varchar(36) NOT NULL,
	POST_ID varchar(40) NOT NULL,
	FILE_ORG_NM varchar(255),
	FILE_SAVE_NM varchar(255),
	FILE_SIZE bigint,
	FILE_PATH varchar(255),
	RGST_DT timestamp DEFAULT NOW() NOT NULL,
	RGST_ID varchar(20),
	UPDT_DT timestamp DEFAULT NOW() NOT NULL,
	UPDT_ID varchar(20),
	DEL_YN char(1) DEFAULT 'N' NOT NULL,
	PRIMARY KEY (FILE_ID, POST_ID)
);


CREATE TABLE TB_POST
(
	POST_ID varchar(40) NOT NULL,
	BOARD_ID varchar(5) NOT NULL,
	USER_ID varchar(20) NOT NULL,
	POST_TTL varchar(50) NOT NULL,
	POST_CNT text NOT NULL,
	RGST_DT timestamp DEFAULT NOW() NOT NULL,
	RGST_ID varchar(20),
	UPDT_DT timestamp DEFAULT NOW() NOT NULL,
	UPDT_ID varchar(20),
	DEL_YN char(1) DEFAULT 'N' NOT NULL,
	PRIMARY KEY (POST_ID)
);


CREATE TABLE TB_ROLE
(
	ROLE_ID varchar(10) NOT NULL,
	ROLE_NM varchar(9) NOT NULL,
	RGST_DT timestamp DEFAULT NOW() NOT NULL,
	RGST_ID varchar(20),
	UPDT_DT timestamp DEFAULT NOW() NOT NULL,
	UPDT_ID varchar(20),
	DEL_YN char(1) DEFAULT 'N' NOT NULL,
	PRIMARY KEY (ROLE_ID)
);


CREATE TABLE TB_USER
(
	USER_ID varchar(20) NOT NULL,
	USER_NM varchar(10) NOT NULL,
	USER_PW char(60) NOT NULL,
	RGST_DT timestamp DEFAULT NOW() NOT NULL,
	RGST_ID varchar(20),
	UPDT_DT timestamp DEFAULT NOW() NOT NULL,
	UPDT_ID varchar(20),
	DEL_YN char(1) DEFAULT 'N' NOT NULL,
	PRIMARY KEY (USER_ID)
);


CREATE TABLE TB_USERAUTH
(
	USER_ID varchar(20) NOT NULL,
	ROLE_ID varchar(10) NOT NULL,
	RGST_DT timestamp DEFAULT NOW() NOT NULL,
	RGST_ID varchar(20),
	UPDT_DT timestamp DEFAULT NOW() NOT NULL,
	UPDT_ID varchar(20),
	DEL_YN char(1) DEFAULT 'N' NOT NULL,
	PRIMARY KEY (USER_ID, ROLE_ID)
);



/* Create Foreign Keys */

ALTER TABLE TB_POST
	ADD FOREIGN KEY (BOARD_ID)
	REFERENCES TB_BOARD (BOARD_ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE TB_CMNT
	ADD FOREIGN KEY (POST_ID)
	REFERENCES TB_POST (POST_ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE TB_USERAUTH
	ADD FOREIGN KEY (ROLE_ID)
	REFERENCES TB_ROLE (ROLE_ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE TB_CMNT
	ADD FOREIGN KEY (USER_ID)
	REFERENCES TB_USER (USER_ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE TB_POST
	ADD FOREIGN KEY (USER_ID)
	REFERENCES TB_USER (USER_ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE TB_USERAUTH
	ADD FOREIGN KEY (USER_ID)
	REFERENCES TB_USER (USER_ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;



